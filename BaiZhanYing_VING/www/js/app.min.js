var defaultUrl="https://111.205.107.195:443/Sns/service/pushInterface/",defaultWsUrl="ws://111.205.107.195:15825/Sns/websocket";angular.module("starter",["ionic","ngResource","ngSanitize"]).factory("cameraService",["$q",function(e){return{getPicture:function(t){var r=e.defer();return navigator.camera?(navigator.camera.getPicture(function(e){r.resolve(e)},function(e){r.reject(e)},t),r.promise):(r.resolve(null),r.promise)}}}]).factory("wsService",["$timeout","$rootScope","$localstorage",function(e,t,r){var s,a,n=!1,o=!1,i=!1,l=1e3,c=3e4,u=1.5,d=2e3,f=0,g={};return g.init=function(m,p){a=m;var h=r.getObject("user");if("WebSocket"in window){s=new WebSocket(a,p||[]);var w=s;f=0;var b=e(function(){i=!0,w.close(),i=!1},d);s.onopen=function(r){e.cancel(b),f=0,t.$broadcast("wsService:onopen",r);var a={};a.type="login",a.userId=h.id.toString(),s.send(angular.toJson(a)),o=!0},s.onclose=function(){if(e.cancel(t),s=null,n);else{var t=l*Math.pow(u,f);e(function(){f++,g.init(a)},t>c?c:t)}},s.onmessage=function(e){t.$broadcast("wsService:onmessage",e)},s.onerror=function(){t.$broadcast("wsService:onerror")},window.onbeforeunload=function(){s.close()}}},g.send=function(e){if(s)return e.type="say",s.send(angular.toJson(e));throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},g.close=function(e,t){"undefined"==typeof e&&(e=1e3),n=!0,s&&s.close(e,t)},g.refresh=function(){s&&s.close()},g}]).factory("JpushService",["$rootScope","$timeout",function(e,t){var r,s=function(r){try{var s,a,n=ionic.Platform.platform();"android"==n?(s=window.plugins.jPushPlugin.openNotification.alert,a=window.plugins.jPushPlugin.openNotification.extras):(s=r.aps.alert,a=r)}catch(o){}t(function(){e.$broadcast("JpushService:openNotification",s,a)})},a=function(r){try{var s,a,n=ionic.Platform.platform();"android"==n?(s=window.plugins.jPushPlugin.receiveNotification.alert,a=window.plugins.jPushPlugin.receiveNotification.extras):(s=r.aps.alert,a=r)}catch(o){}t(function(){e.$broadcast("JpushService:receiveNotification",s,a)})},n=function(r){try{var s,a,n=ionic.Platform.platform();"android"==n?(s=window.plugins.jPushPlugin.receiveMessage.message,a=window.plugins.jPushPlugin.receiveMessage.extras):(s=r.content,a=r.extras)}catch(o){}t(function(){e.$broadcast("JpushService:receiveMessage",s,a)})};return{setTagsWithAlias:function(e,t){if(r)try{window.plugins.jPushPlugin.setTagsWithAlias(e,t)}catch(s){}},setTags:function(e){if(r)try{window.plugins.jPushPlugin.setTags(e)}catch(t){}},setBadge:function(e){r&&window.plugins.jPushPlugin.isPlatformIOS()&&window.plugins.jPushPlugin.setBadge(e)},setApplicationIconBadgeNumber:function(e){window.plugins.jPushPlugin.isPlatformIOS()&&window.plugins.jPushPlugin.setApplicationIconBadgeNumber(e)},setAlias:function(e){r&&window.plugins.jPushPlugin.setAlias(e)},check:function(){window.jpush&&r&&(plugins.jPushPlugin.receiveNotificationIniOSCallback(window.jpush),window.jpush=null)},init:function(){r=window.plugins&&window.plugins.jPushPlugin,r&&(window.plugins.jPushPlugin.init(),window.plugins.jPushPlugin.setDebugMode(!0),document.addEventListener("jpush.openNotification",s,!1),document.addEventListener("jpush.receiveNotification",a,!1),document.addEventListener("jpush.receiveMessage",n,!1))}}}]).factory("BusyService",["$ionicLoading",function(e){return{show:function(t){e.show({template:t||"正在加载...",animation:"fade-in"})},hide:function(){e.hide()}}}]).factory("StoreUp",["$resource",function(e){return e(defaultUrl,null,{})}]).factory("LastTime",["$localstorage","$filter",function(e,t){return{getLastExitTime:function(){return e.get("lastExitTime",t("date")(new Date,"yyyy-MM-dd HH:mm:ss"))},setExitTime:function(){e.set("lastExitTime",t("date")(new Date,"yyyy-MM-dd HH:mm:ss"))},getLastRequestTime:function(){return e.get("lastRequestTime")},setRequestTime:function(r){e.set("lastRequestTime",t("date")(null==r?new Date:r,"yyyy-MM-dd HH:mm:ss"))},getLastChatTime:function(){return e.get("lastChatTime")},setLastChatTime:function(r){e.set("lastChatTime",t("date")(null==r?new Date:r,"yyyy-MM-dd HH:mm:ss"))}}}]).factory("UUIDFac",function(){function e(){this.id=this.createUUID()}return e.prototype.valueOf=function(){return this.id},e.prototype.toString=function(){return this.id},e.prototype.createUUID=function(){var t=new Date(1582,10,15,0,0,0,0),r=new Date,s=r.getTime()-t.getTime(),a=e.getIntegerBits(s,0,31),n=e.getIntegerBits(s,32,47),o=e.getIntegerBits(s,48,59)+"1",i=e.getIntegerBits(e.rand(4095),0,7),l=e.getIntegerBits(e.rand(4095),0,7),c=e.getIntegerBits(e.rand(8191),0,7)+e.getIntegerBits(e.rand(8191),8,15)+e.getIntegerBits(e.rand(8191),0,7)+e.getIntegerBits(e.rand(8191),8,15)+e.getIntegerBits(e.rand(8191),0,15);return a+n+o+i+l+c},e.getIntegerBits=function(t,r,s){var a=e.returnBase(t,16),n=new Array,o="",i=0;for(i=0;i<a.length;i++)n.push(a.substring(i,i+1));for(i=Math.floor(r/4);i<=Math.floor(s/4);i++)o+=n[i]&&""!=n[i]?n[i]:"0";return o},e.returnBase=function(e,t){return e.toString(t).toUpperCase()},e.rand=function(e){return Math.floor(Math.random()*(e+1))},{getUUID:function(){return new e}}}).factory("TjywyService",function(){var e=[{id:"0",name:"业务员1",ywyClass:"5级",headImg:"img/sp1.png",lastStarInfoTime:"2015年2月1日"},{id:"1",name:"业务员2",ywyClass:"5级",headImg:"img/sp2.png",lastStarInfoTime:"2015年2月1日"},{id:"2",name:"业务员3",ywyClass:"4级",headImg:"img/sp3.png",lastStarInfoTime:"2015年2月1日"},{id:"3",name:"业务员4",ywyClass:"2级",headImg:"img/sp4.png",lastStarInfoTime:"2015年2月2日"}];return{all:function(){return e},remove:function(t){e.splice(e.indexOf(t),1)},get:function(t){for(var r=0;r<e.length;r++)if(e[r].id===parseInt(t))return e[r];return null}}}).factory("webLocalDB",function(){function e(e){var t="create table star(id text,name text,newName text,lastStarInfoTitle text,category integer,price real,createTime numeric,createUser text,lastStarInfoTime numeric,sn text,headImg text,badge numeric,ownUser text,eStarUserId text,primary key(id,ownUser))";e.executeSql(t),t="create table starInfo(id text,starId text,title text,headImg text,message text,messageType integer,dateTime numeric,createUser text,price numeric,ownUser text,addFile text,fileName text,primary key(id,ownUser))",e.executeSql(t),t="create table starBuy(id text,starId text,isBuy text,buyStartTime numeric,buyEndTime numeric,ownUser text,primary key(id,ownUser))",e.executeSql(t),t="create table chat(id text,userId text,message text,time numeric,ownUser text,isSendSuccess integer,primary key(id,ownUser))",e.executeSql(t),t="create table storeUp(id text,starInfoId text,title text,description text,message text,datetime numeric,userName text,headImg text,ownUser text,primary key(id,ownUser))",e.executeSql(t),t="create table chatUser(userId text,badge numeric,lastMessage text,lastTime numeric,ownUser text,primary key(userId,ownUser))",e.executeSql(t)}try{var t=window.openDatabase("mydb","1.0","我的第一个客户端数据库",2097152)}catch(r){}return t.transaction(e),{getDb:function(){return t},insertStarBuy:function(e){function r(t){var r="insert into starBuy(id,starId,isBuy,buyStartTime,buyEndTime,ownUser) values (?,?,?,?,?,?)",s=new Array;s[0]=e.id,s[1]=e.starId,s[2]=e.isBuy,s[3]=e.buyStartTime,s[4]=e.buyEndTime,s[5]=e.ownUser,t.executeSql(r,s)}t.transaction(r)},updateStarBuy:function(){function e(e){function t(e,t){}function r(e,t){}var s="update starBuy set ";""!=starBuy.isBuy&&null!=starBuy.isBuy&&void 0!=starBuy.isBuy&&(s+="isBuy = '"+starBuy.isBuy+"', "),""!=starBuy.buyStartTime&&null!=starBuy.buyStartTime&&void 0!=starBuy.buyStartTime&&(s+="buyStartTime = '"+starBuy.buyStartTime+"', "),""!=starBuy.buyEndTime&&null!=starBuy.buyEndTime&&void 0!=starBuy.buyEndTime&&(s+="buyEndTime = '"+starBuy.buyEndTime+"', "),s=s.substring(0,s.length-2),s+=" where starId = '"+starBuy.starId+"' and ownUser = '"+starBuy.ownUser+"'",e.executeSql(s,[],t,r)}t.transaction(e)},selectStarInfoById:function(e,r,s){function a(t){var a="select id,starId,title,headImg,message,messageType,dateTime,createUser,price,ownUser,addFile,fileName from starInfo where id = '"+e+"' and ownUser = '"+r+"'";t.executeSql(a,[],s,n)}function n(e,t){}t.transaction(a)},selectStarInfoList:function(e,r,s,a,n){function o(t){var o="select id,starId,title,headImg,message,messageType,dateTime,createUser,price,ownUser,addFile,fileName from starInfo where starId = '"+e+"' and ownUser = '"+r+"' ";o+=" order by dateTime desc ",a-=1,o+=" limit "+s+" offset "+s*a,t.executeSql(o,[],n,i)}function i(e,t){}t.transaction(o)},insertStarInfo:function(e){function r(t){function r(e,t){}function s(e,t){}var a="insert into starInfo (id,starId,title,headImg,message,messageType,dateTime,ownUser,addFile,fileName) values(?,?,?,?,?,?,?,?,?,?)",n=new Array;n[0]=e.id,n[1]=e.starId,n[2]=e.title,n[3]=e.headImg,n[4]=e.message,n[5]=e.messageType,n[6]=e.dateTime,n[7]=e.ownUser,n[8]=e.addFile,n[9]=e.fileName,t.executeSql(a,n,r,s)}t.transaction(r)},updateStarInfo:function(e){function r(t){function r(e,t){}function s(e,t){}var a="update starInfo set ";""!=e.starId&&null!=e.starId&&void 0!=e.starId&&(a+="starId = '"+e.starId+"', "),""!=e.title&&null!=e.title&&void 0!=e.title&&(a+="title = '"+e.title+"', "),""!=e.headImg&&null!=e.headImg&&void 0!=e.headImg&&(a+="headImg = '"+e.headImg+"', "),""!=e.message&&null!=e.message&&void 0!=e.message&&(a+="message = '"+e.message+"', "),""!=e.messageType&&null!=e.messageType&&void 0!=e.messageType&&(a+="messageType = '"+e.messageType+"', "),""!=e.addFile&&null!=e.addFile&&void 0!=e.addFile&&(a+="addFile = '"+e.addFile+"', "),""!=e.fileName&&null!=e.fileName&&void 0!=e.fileName&&(a+="fileName = '"+e.fileName+"', "),a=a.substring(0,a.length-2),a+=" where id = '"+e.id+"' and ownUser = '"+e.ownUser+"'",t.executeSql(a,[],r,s)}t.transaction(r)},cdStar:function(e,r,s){function a(t){var a="delete from star where ownUser = ? and category = ?";t.executeSql(a,[r,s]),a="insert into star(id,name,newName,lastStarInfoTitle,category,lastStarInfoTime,headImg,badge,ownUser) values (?,?,?,?,?,?,?,?,?)";for(var n=0;n<e.length;n++){var o=e[n],i=new Array;i[0]=o.id,i[1]=o.name,i[2]=o.newName,i[3]=o.lastStarInfoTitle,i[4]=o.category,i[5]=o.lastStarInfoTime,i[6]=o.headImg,i[7]=o.badge,i[8]=o.ownUser,t.executeSql(a,i)}}t.transaction(a)},selectStar:function(e,r){function s(t){var s="select id,name,newName,lastStarInfoTitle,category,price,createTime,createUser,lastStarInfoTime,sn,headImg,badge,ownUser,eStarUserId from star where ownUser = '"+e+"' order by lastStarInfoTime desc";t.executeSql(s,[],r,a)}function a(e,t){}t.transaction(s)},selectStarById:function(e,r,s){function a(t){var a="select id,name,newName,lastStarInfoTitle,category,price,createTime,createUser,lastStarInfoTime,sn,headImg,badge,ownUser,eStarUserId from star where id = '"+e+"' and ownUser = '"+r+"'";t.executeSql(a,[],s,n)}function n(e,t){}t.transaction(a)},insertStar:function(e){function r(t){var r="insert into star(id,name,newName,lastStarInfoTitle,category,lastStarInfoTime,headImg,badge,ownUser,eStarUserId) values (?,?,?,?,?,?,?,?,?,?)",s=new Array;s[0]=e.id,s[1]=e.name,s[2]=e.newName,s[3]=e.lastStarInfoTitle,s[4]=e.category,s[5]=e.lastStarInfoTime,s[6]=e.headImg,s[7]=e.badge,s[8]=e.ownUser,s[9]=e.eStarUserId,t.executeSql(r,s)}t.transaction(r)},updateStar:function(e){function r(t){var r="update star set ";""!=e.name&&null!=e.name&&void 0!=e.name&&(r+=" name = '"+e.name+"', "),""!=e.lastStarInfoTitle&&null!=e.lastStarInfoTitle&&void 0!=e.lastStarInfoTitle&&(r+=" lastStarInfoTitle = '"+e.lastStarInfoTitle+"', "),""!=e.lastStarInfoTime&&null!=e.lastStarInfoTime&&void 0!=e.lastStarInfoTime&&(r+=" lastStarInfoTime = '"+e.lastStarInfoTime+"', "),""!=e.headImg&&null!=e.headImg&&void 0!=e.headImg&&(r+=" headImg = '"+e.headImg+"', "),""!=e.badge&&null!=e.badge&&void 0!=e.badge&&(r+=" badge += "+e.badge+", "),""!=e.eStarUserId&&null!=e.eStarUserId&&void 0!=e.eStarUserId&&(r+=" eStarUserId = '"+e.eStarUserId+"', "),r=r.substring(0,r.length-2),r+=" where id = '"+e.id+"' and ownUser = '"+e.ownUser+"'",t.executeSql(r,[],s,a)}function s(e,t){}function a(e,t){}t.transaction(r)},clearStarBadge:function(e){function r(t){var r="update star set badge = 0 where id = '"+e+"'";t.executeSql(r,[])}t.transaction(r)},insertChat:function(e){function r(t){var r="insert into chat(id,userId,message,time,ownUser,isSendSuccess) values (?,?,?,?,?,?)",s=new Array;s[0]=e.id,s[1]=e.userId,s[2]=e.info,s[3]=e.time,s[4]=e.ownUser,s[5]=e.isSendSuccess,t.executeSql(r,s)}t.transaction(r)},insertChatUser:function(e){function r(t){var r="insert into chatUser(userId,badge,lastMessage,lastTime,ownUser) values (?,?,?,?,?)",n=new Array;n[0]=e.userId.toString(),n[1]=e.badge,n[2]=e.lastMessage,n[3]=e.lastTime,n[4]=e.ownUser.toString(),t.executeSql(r,n,s,a)}function s(e,t){}function a(e,t){}t.transaction(r)},updateChatUser:function(e){function r(t){var r="update chatUser set ";""!=e.badge&&null!=e.badge&&void 0!=e.badge&&(r+="badge += "+e.badge+", "),""!=e.lastMessage&&null!=e.lastMessage&&void 0!=e.lastMessage&&(r+="lastMessage = '"+e.lastMessage+"', "),""!=e.lastTime&&null!=e.lastTime&&void 0!=e.lastTime&&(r+="lastTime = '"+e.lastTime+"', "),r=r.substring(0,r.length-2),r+=" where userId = '"+e.userId+"'",t.executeSql(r)}t.transaction(r)},clearChatUserBadge:function(e){function r(t){var r="update chatUser set badge = 0 where userId = '"+e+"'";t.executeSql(r,[])}t.transaction(r)},selectChatUser:function(e,r){function s(t){var s="select userId,badge,lastMessage,lastTime,ownUser from chatUser where ownUser = '"+e+"'";t.executeSql(s,[],r,a)}function a(e,t){}t.transaction(s)},deleteChatUser:function(e){function r(t){var r="delete from chatUser where ownUser = '"+e+"'";t.executeSql(r,[])}t.transaction(r)},insertStoreUp:function(e){function r(t){var r="insert into storeUp(id,title,message,datetime,userName,ownUser,headImg,starInfoId) values(?,?,?,?,?,?,?,?)",s=new Array;s[0]=e.id,s[1]=e.name,s[2]=e.content,s[3]=e.datetime,s[4]=e.userName,s[5]=e.userId,s[6]=e.headImg,s[7]=e.starInfoId,t.executeSql(r,s)}t.transaction(r)},deleteStoreUp:function(e){function r(t){var r="delete from storeUp where id = '"+e+"'";t.executeSql(r,[])}t.transaction(r)},searchStoreUp:function(e,r,s){function a(t){var a="select id,starInfoId,title,description,message,datetime,userName,headImg,ownUser from storeUp where title like '%"+e+"%' or message like '%"+e+"%' and ownUser = "+r;t.executeSql(a,[],s,n)}function n(e,t){}t.transaction(a)},selectStoreUp:function(e,r){function s(t){var s="select id,starInfoId,title,description,message,datetime,userName,headImg,ownUser from storeUp where ownUser = '"+e+"'";t.executeSql(s,[],r,a)}function a(e,t){}t.transaction(s)},getStoreUpById:function(e,r){function s(t){var s="select id,starInfoId,title,description,message,datetime,userName,headImg,ownUser from storeUp where id = '"+e+"'";t.executeSql(s,[],r,a)}function a(e,t){}t.transaction(s)}}}).factory("barcodeScanner",function(){return{scan:function(){window.plugins.barcodeScanner.scan(function(e){},function(e){})}}}).factory("$localstorage",["$window",function(e){return{set:function(t,r){e.localStorage[t]=r},get:function(t,r){return e.localStorage[t]||r},setObject:function(t,r){e.localStorage[t]=JSON.stringify(r)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")}}}]).factory("Fws",["$resource",function(e){return e(defaultUrl,null,{allNewStar:{method:"GET",url:defaultUrl+"starList/:pageIndex",cache:!1}})}]).factory("Sps",function(){var e=[];return{all:function(){return e},remove:function(t){e.splice(e.indexOf(t),1)},get:function(t){for(var r=0;r<e.length;r++)if(e[r].id===parseInt(t))return e[r];return null}}}).factory("Tss",function(){var e=[];return{all:function(){return e},remove:function(t){e.splice(e.indexOf(t),1)},get:function(t){for(var r=0;r<e.length;r++)if(e[r].id===parseInt(t))return e[r];return null}}}).factory("Bgs",function(){var e=[];return{all:function(){return e},remove:function(t){e.splice(e.indexOf(t),1)},get:function(t){for(var r=0;r<e.length;r++)if(e[r].id===parseInt(t))return e[r];return null}}}).factory("Lcs",["$resource",function(e){var t=[];return{all:function(){return t},remove:function(e){t.splice(t.indexOf(e),1)},get:function(e){for(var r=0;r<t.length;r++)if(t[r].id===parseInt(e))return t[r];return null}}}]).factory("FwLists",["$resource",function(e){return e(defaultUrl,null,{all:{method:"GET",url:defaultUrl+"pushMessageList/:starId/:pageIndex",cache:!1},getStarById:{method:"GET",url:defaultUrl+"getStarById/:starId",cache:!1},pushMessageListBySqlesmanId:{method:"GET",url:defaultUrl+"pushMessageListBySqlesmanId/:salesmanId",cache:!1}})}]).factory("RemoteService",["$resource",function(e){return e(defaultUrl,null,{loginByPhone:{method:"get",url:defaultUrl+"loginByPhone",cache:!1},registByPhone:{method:"get",url:defaultUrl+"registByPhone",cache:!1},getCaptchaByPhone:{method:"get",url:defaultUrl+"getCaptchaByPhone/:phoneNumber",cache:!1},addBusinessByUserId:{method:"get",url:defaultUrl+"addBusinessByUserId",cache:!1},removeBusinessByUserId:{method:"get",url:defaultUrl+"removeBusinessByUserId",cache:!1},selectStoreUp:{method:"GET",url:defaultUrl+"selectEstarCollection/:pageIndex",cache:!1},getStoreUpById:{method:"GET",url:defaultUrl+"selectEstarCollectionById",cache:!1},addStoreUp:{method:"GET",url:defaultUrl+"addEstarCollection",cache:!1},deleteStoreUp:{method:"get",url:defaultUrl+"deleteEstarCollectionById/:storeUpId",cache:!1},allTjywy:{method:"GET",url:defaultUrl+"userList/1",cache:!1},sendMessage:{method:"GET",url:defaultUrl+"addNewAsk",cache:!1},reviceMessage:{method:"GET",url:defaultUrl+"askAnswerList/1",cache:!1},updateUserName:{method:"GET",url:defaultUrl+"updateUserName",cache:!1},updateUserAvatar:{method:"GET",url:defaultUrl+"updateUserAvatar",cache:!1},updateUserPassword:{method:"GET",url:defaultUrl+"updateUserPassword",cache:!1},insertUserOpinion:{method:"GET",url:defaultUrl+"insertUserOpinion",cache:!1},checkIsBuy:{method:"GET",url:defaultUrl+"StarBuyVerification/:eStarUserId",cache:!1},getStarInfoById:{method:"GET",url:defaultUrl+"getStarInfoById/:starInfoId",cache:!1}})}]).factory("Chats",["$resource",function(e){return e(defaultUrl,null,{})}]).controller("startController",["wsService","$ionicPopup","BusyService","$timeout","RemoteService","$localstorage","$location","$scope","$state","$ionicNavBarDelegate","$rootScope",function(e,t,r,s,a,n,o,i,l,c,u){function d(){return"0"==i.loginResponse?(s.cancel(i.lto),r.hide(),t.alert({title:"提示",template:"登录超时，请稍后重试！",okText:"确定"}),!1):void 0}e.init(defaultWsUrl),i.go=function(e,t){""!=t&&null!=t&&"undefined"!=t?"tab.fwlist"==e&&o.path("/tab/fwl/"+t):l.go(e)},i.loginResponse="0",u.$on("Login:loginTimeOut",function(e,o){i.lto=s(d,8e3),i.user=n.getObject("user");var c={};c.phone=i.user.phone,c.password=i.user.password,r.show(),i.lto=s(d,8e3),a.loginByPhone(c,function(e){if(i.loginResponse="1","200"==e.return_code)r.hide(),i.user.businessUserAvatar=e.data.businessUserAvatar,i.user.sessionId=e.data.sessionId,n.setObject("user",i.user),o&&o();else{r.hide();var s=t.alert({title:"提示",template:e.message,okText:"确定"});s.then(function(e){l.go("signin")})}},function(e){r.hide(),t.alert({title:"提示",template:"登录失败，请重试！",okText:"确定"})})})}]).controller("NicenameCtrl",["$rootScope","BusyService","$state","RemoteService","$localstorage","$scope",function(e,t,r,s,a,n){n.$on("$ionicView.enter",function(){n.user=a.getObject("user")}),n.updateNicenamess=function(o){var i={};i.sessionId=a.getObject("user").sessionId,i.name=o.name,t.show(),s.updateUserName(i,function(r){t.hide(),"20006"==r.return_code&&(t.hide(),n.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){t.hide(),$ionicPopup.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}),a.setObject("user",o),r.go("tab.wo-person")}}]).controller("RepasswordCtrl",["$rootScope","BusyService","$state","RemoteService","$ionicPopup","$localstorage","$scope",function(e,t,r,s,a,n,o){var i=n.getObject("user");o.updateUserPassword=function(l){if(l.newPassword!=l.reNewPassword){var c=a.alert({title:"提示",template:"两次输入的密码不一致，请重新输入！"});c.then(function(e){return!1})}else delete l.reNewPassword,l.sessionId=n.getObject("user").sessionId,t.show("提交中..."),s.updateUserPassword(l,function(s){if(t.hide(),"200"==s.return_code){i.password=l.newPassword,n.setObject("user",i);var c=a.alert({title:"提示",template:"密码已修改!"});c.then(function(e){r.go("tab.wo")})}if("20004"==s.return_code){var u=a.alert({title:"提示",template:"原始密码不正确，请重新输入!"});u.then(function(e){delete l.oldPassword,delete l.newPassword})}"20006"==s.return_code&&(t.hide(),o.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){t.hide(),a.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}}]).controller("PersonCtrl",["cameraService","$timeout","$rootScope","$state","$localstorage","$scope","$ionicActionSheet",function(e,t,r,s,a,n,o){function i(e){t(function(){n.user.avatarUrl=e,a.setObject(n.user.id,{avatarUrl:n.user.avatarUrl}),a.setObject("user",n.user),s.go("tab.wo")})}function l(e){t(function(){})}n.$on("$ionicView.enter",function(){n.user=a.getObject("user"),null!=n.user.name||(n.user.name="未设置"),null!=n.user.phone||(n.user.phone="未设置"),n.currentUser=a.getObject(n.user.id),null!=n.currentUser.avatarUrl?n.user.avatarUrl=n.currentUser.avatarUrl:n.user.avatarUrl="img/headicon_new.jpg"}),n.headUrl="",n.showActionSheet=function(){o.show({buttons:[{text:"拍照"},{text:"从手机相册选择"}],cancelText:"取消",cancel:function(){},buttonClicked:function(t){if(0==t){var r={quality:50,desinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0};e.getPicture(r).then(i,l)}if(1==t){var r={quality:50,desinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0};navigator.camera.getPicture(i,l,r)}return!0}})}}]).controller("PasswordCtrl",["$scope",function(e){}]).controller("StoreupCtrl",["$filter","$rootScope","BusyService","RemoteService","$scope","$state","$localstorage","webLocalDB",function(e,t,r,s,a,n,o,i){function l(e,t){var r=t.rows;"1"==a.isSearch&&(a.items=[]);for(var s=0;s<r.length;s++){var n=r.item(s),o={};for(var i in n)o[i]=n[i];if("1"==a.isSearch)a.items.push(o);else if(0!=a.items.length){for(var l=!1,c=0;c<a.items.length;c++)if(a.items[c].id==o.id){l=!0;break}l||a.items.push(o)}else a.items.push(o)}}function c(){i.selectStoreUp(a.myId,l)}a.isSearch;var u=o.getObject("user");a.myId=u.id;i.getDb();a.goBack=function(){},a.deletes=function(e){r.show(),i.deleteStoreUp(e.id),s.deleteStoreUp({storeUpId:e.id,sessionId:o.getObject("user").sessionId},function(e){r.hide(),"20006"==e.return_code&&(r.hide(),a.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),$ionicPopup.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})});for(var n=0;n<a.items.length;n++){var l=a.items[n];if(e.id==l.id){a.items.splice(n,1);break}}},a.label=function(e){},a.search=function(e){a.isSearch="1",i.searchStoreUp(e,a.myId,l)},a.addStoreup=function(e){n.go("wo-storeup-add")},a.pageIndex=1,a.$on("$ionicView.enter",function(){r.show(),s.selectStoreUp({pageIndex:a.pageIndex,sessionId:o.getObject("user").sessionId},function(s){if(r.hide(),"200"==s.return_code){for(var n=s.data,o=0;o<n.length;o++)n[o].ownUser=u.id.toString(),n[o].datetime=e("date")(n[o].collectionTime,"yyyy年MM月dd日 HH:mm:ss"),n[o].headImg="",n[o].starInfoId="",i.insertStoreUp(n[o]);20==n.length&&(a.pageIndex+=1)}"20006"==s.return_code&&(r.hide(),a.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),$ionicPopup.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}),a.isSearch="0",c()}),a.items=[]}]).controller("StoreupContentCtrl",["$filter","$rootScope","$timeout","$scope","$stateParams","$localstorage","webLocalDB","StoreUp",function(e,t,r,s,a,n,o,i){function l(e,t){for(var r=t.rows,a=0;a<r.length;a++){var n=r.item(a),o={};for(var i in n)o[i]=n[i];s.content=o}}var c=n.getObject("user");o.getDb();s.myId=c.id,o.getStoreUpById(a.storeUpId,l),s.content={}}]).controller("StoreupAddCtrl",["$rootScope","$ionicPopup","BusyService","RemoteService","$scope","webLocalDB","StoreUp","$localstorage","UUIDFac","$state","$filter",function(e,t,r,s,a,n,o,i,l,c,u){var d=i.getObject("user"),f=d.phone,g=(d.id,d.headImg);a.addStoreWenZi=function(){r.show("增加收藏中，请稍后...");var o={};o.id=l.getUUID().id,o.starInfoId,o.userName=f,o.description,o.name="文字 "+u("date")(new Date,"yyyy年MM月dd日"),o.userId=i.getObject("user").id,o.sessionId=i.getObject("user").sessionId,o.headImg=g,o.content=a.item;(new Date).getTime();o.datetime=u("date")(new Date,"yyyy年MM月dd日"),n.insertStoreUp(o),s.addStoreUp(o,function(s){"200"==s.return_code&&(r.hide(),a.alertPopup=t.alert({title:"提示",template:"收藏成功！"})),"20006"==s.return_code&&(r.hide(),a.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),t.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}),a.alertPopup.then(function(e){c.go("wo-storeup")})},a.item={content:""}}]).controller("BuserCtrl",["$rootScope","BusyService","webLocalDB","$state","$ionicPopup","RemoteService","$localstorage","$scope",function(e,t,r,s,a,n,o,i){var l;i.$on("$ionicView.enter",function(){l=o.getObject("user"),i.buser=l,i.myId=l.id,null!=i.buser.businessUserAvatar||(i.buser.businessUserAvatar="img/headicon_new.jpg"),null==i.buser.businessUserName&&(i.buser.businessUserName="未设置"),null==i.buser.businessPhone&&(i.buser.businessPhone="暂无"),null==i.buser.businessLevel&&(i.buser.businessLevel=1)}),i.unbind=function(){var c=a.confirm({title:"提示",template:"解绑后，您将不能继续接受业务员的信息，您确定与业务员解绑吗?"});c.then(function(c){c&&(t.show("解绑中..."),n.removeBusinessByUserId({sessionId:o.getObject("user").sessionId},function(n){l.businessUserId="",l.businessUserName="",l.businessUserAvatar="",o.setObject("user",l),r.deleteChatUser(i.myId),t.hide();var c=a.alert({title:"提示",template:"解绑成功！",okText:"确定"});c.then(function(e){s.go("tab.fw")}),"20006"==n.return_code&&(t.hide(),i.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){t.hide(),a.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}))})}}]).controller("SettingCtrl",["$interval","$rootScope","$ionicPopup","LastTime","$localstorage","$state","$scope",function(e,t,r,s,a,n,o){a.getObject("user");o.logout=function(){var o=r.confirm({title:"提示",template:"您确定退出登录吗？"});o.then(function(r){r&&(angular.isDefined(t.stopChat)&&(e.cancel(t.stopChat),t.stopChat=void 0),angular.isDefined(t.stop)&&(e.cancel(t.stop),t.stop=void 0),a.set("user",""),s.setExitTime(),s.setRequestTime(),s.setLastChatTime(),n.go("signin"))})}}]).controller("SettingAboutCtrl",["$scope",function(e){}]).controller("SettingOpinionCtrl",["$rootScope","BusyService","$ionicPopup","RemoteService","$state","$localstorage","$scope",function(e,t,r,s,a,n,o){o.opinion={content:"",contact:"",userInfoId:""};n.getObject("user");o.opinion.sessionId=n.getObject("user").sessionId,o.saveOpinion=function(n){t.show("提交中，请稍后..."),s.insertUserOpinion(o.opinion,function(s){if(t.hide(),"200"==s.return_code){var n=r.alert({title:"提示",template:"您的意见已经提交，感谢您对产品的支持！",okText:"确定"});n.then(function(e){a.go("tab.wo-setting")})}"20006"==s.return_code&&(t.hide(),o.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){t.hide(),r.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}}]).controller("FwTabCtrl",["$scope","$ionicTabsDelegate",function(e,t){e.fwBadge=0,e.$on("fwTabUnReadCount",function(t,r){e.fwBadge=r}),e.f_fwSelect=function(){},e.f_fwDeselect=function(){}}]).controller("SignInCtrl",["$rootScope","JpushService","webLocalDB","$timeout","$filter","BusyService","$scope","$state","$localstorage","$ionicPopup","RemoteService",function(e,t,r,s,a,n,o,i,l,c,u){function d(){return"0"==o.loginResponse?(s.cancel(o.lto),n.hide(),c.alert({title:"提示",template:"登录超时，请稍后重试！",okText:"确定"}),!1):void 0}var f=l.getObject("user"),g=f.phone,m=f.password;if(o.loginResponse="0",o.signIn=function(e){return void 0==e?(c.alert({title:"提示",template:"手机号和密码不能为空！",okText:"确定"}),!1):void 0==e.phone?(c.alert({title:"提示",template:"手机号不能为空！",okText:"确定"}),!1):void 0==e.password?(c.alert({title:"提示",template:"密码不能为空！",okText:"确定"}),!1):(n.show("登陆中..."),o.lto=s(d,8e3),void u.loginByPhone(e,function(t){if(o.loginResponse="1",n.hide(),"200"==t.return_code){e.businessUserId=t.data.businessUserId,e.businessUserName=t.data.businessUserName,e.businessUserAvatar=t.data.businessUserAvatar,e.isActivation=t.data.isActivation,e.sessionId=t.data.sessionId,e.id=t.data.id,e.name=t.data.name,e.avatarUrl=t.data.avatarUrl,l.setObject("user",""),l.setObject("user",e),r.deleteChatUser(e.id);var s={userId:e.businessUserId,badge:0,lastMessage:"",lastTime:"",ownUser:e.id};r.insertChatUser(s),i.go("tab.fw")}else c.alert({title:"提示",template:t.message,okText:"确定"})},function(e){n.hide(),c.alert({title:"提示",template:"登录失败，请重试！",okText:"确定"})}))},angular.isString(g)&&angular.isString(m)){var p={};p.phone=g,p.password=m,n.show("登陆中..."),o.lto=s(d,8e3),u.loginByPhone(p,function(e){o.loginResponse="1","200"==e.return_code?(n.hide(),f.businessUserAvatar=e.data.businessUserAvatar,f.sessionId=e.data.sessionId,l.setObject("user",f),i.go("tab.fw")):(n.hide(),c.alert({title:"提示",template:e.message,okText:"确定"}))},function(e){n.hide(),c.alert({title:"提示",template:"登录失败，请重试！",okText:"确定"})})}}]).controller("SignUpCtrl",["$rootScope","BusyService","$scope","$state","$localstorage","$ionicPopup","RemoteService",function(e,t,r,s,a,n,o){r.signUp=function(e){t.show("正在注册..."),o.registByPhone(e,function(e){if("200"==e.return_code){t.hide();var r=n.alert({title:"提示",template:"注册成功！",okText:"确定"});r.then(function(e){s.go("signin")})}if("20003"==e.return_code){t.hide();var r=n.alert({title:"提示",template:"手机号已经注册，请使用其他的手机号注册！",okText:"确定"})}},function(e){t.hide(),n.alert({title:"提示",template:"注册失败，请重试！",okText:"确定"})})}}]).controller("FwCtrl",["$ionicSlideBoxDelegate","$rootScope","JpushService","BusyService","$filter","$scope","$ionicLoading","$localstorage","$state","$location","$ionicPopup","$timeout","$interval","Fws","Sps","Lcs","Tss","Bgs","RemoteService","webLocalDB","LastTime",function(e,t,r,s,a,n,o,i,l,c,u,d,f,g,m,p,h,w,b,I,S){function v(){n.starInfoCount=n.tsBadge+n.zxBadge+n.bgBadge+n.spBadge+n.lcBadge,n.starInfoCount<0&&(n.starInfoCount=0),n.$emit("fwTabUnReadCount",n.starInfoCount)}function U(e,t){"1"==e&&(n.zxBadge+=t),"2"==e&&(n.lcBadge+=t),"3"==e&&(n.spBadge+=t),"4"==e&&(n.bgBadge+=t),"5"==e&&(n.tsBadge+=t),v()}function y(e,t){"1"==e&&(n.zxBadge-=t,n.zxBadge<0&&(n.zxBadge=0)),"2"==e&&(n.lcBadge-=t,n.lcBadge<0&&(n.lcBadge=0)),"3"==e&&(n.spBadge-=t,n.spBadge<0&&(n.spBadge=0)),"4"==e&&(n.bgBadge-=t,n.bgBadge<0&&(n.bgBadge=0)),"5"==e&&(n.tsBadge-=t,n.tsBadge<0&&(n.tsBadge=0)),v()}function T(){}function $(e,r){g.allNewStar({sessionId:e,pageIndex:r},function(e){if(s.hide(),"200"==e.return_code){var r=e.data;n.zxResult=e.data;for(var o=(new Array,0);o<r.length;o++)n.zxResult[o].ownUser=L.id.toString(),n.zxResult[o].lastStarInfoTime=a("date")(n.zxResult[o].lastStarInfoTime,"yyyy年MM月dd日 HH:mm:ss"),I.insertStar(n.zxResult[o]),I.updateStar(n.zxResult[o]);x(),n.$broadcast("scroll.refreshComplete")}"20006"==e.return_code&&(n.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){s.hide(),n.$broadcast("scroll.refreshComplete"),u.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}function x(){I.selectStar(L.id,B)}function B(e,t){for(var s=[],a=t.rows,o=new Array,i=0;i<a.length;i++){var l=a.item(i),c={};for(var u in l)"id"==u&&(c.id=l[u],s.push(c.id.toString().replace(/-/g,"").toString())),"name"==u&&(c.name=l[u]),"newName"==u&&(c.newName="undefined"==l[u]?"":l[u]),"lastStarInfoTitle"==u&&(c.lastStarInfoTitle="undefined"==l[u]?"":l[u]),"headImg"==u&&(c.headImg=l[u]),"lastStarInfoTime"==u&&(c.lastStarInfoTime="undefined"==l[u]?"":l[u]),"category"==u&&(c.category=l[u]),"badge"==u&&(c.badge="undefined"==l[u]?0:l[u]),"eStarUserId"==u&&(c.eStarUserId="undefined"==l[u]?"":l[u]);o.push(c)}if(r.setTagsWithAlias(s,A.toString()),n.allStar=o,n.allStar=o,R){R=!1;for(var i=1;5>=i;i++)1==i&&(n.zxs=C(1,n.allStar,n.zxs)),
2==i&&(n.lcs=C(2,n.allStar,n.lcs)),3==i&&(n.sps=C(3,n.allStar,n.sps)),4==i&&(n.bgs=C(4,n.allStar,n.bgs)),5==i&&(n.tss=C(5,n.allStar,n.tss))}else 1==n.currentSelect&&(n.zxs=C(n.currentSelect,n.allStar,n.zxs)),2==n.currentSelect&&(n.lcs=C(n.currentSelect,n.allStar,n.lcs)),3==n.currentSelect&&(n.sps=C(n.currentSelect,n.allStar,n.sps)),4==n.currentSelect&&(n.bgs=C(n.currentSelect,n.allStar,n.bgs)),5==n.currentSelect&&(n.tss=C(n.currentSelect,n.allStar,n.tss))}function C(e,t,r){for(var s=t,a=new Array,o=0;o<s.length;o++){var i=s[o];if(i.category==e){for(var l=!0,c=0;c<r.length;c++)if(i.id==r[c].id){l=!1,i.isNew=!1;break}l&&(i.isNew=!0),0==n.zxs.length&&(i.isNew=!0),a.push(i)}}for(var o=0;o<a.length;o++)a[o].isNew&&r.unshift(a[o]);return r}function O(e){0==e&&(n.currentSelect="5",n.tss=C(n.currentSelect,n.allStar,n.tss)),1==e&&(n.currentSelect="1",n.zxs=C(n.currentSelect,n.allStar,n.zxs)),2==e&&(n.currentSelect="4",n.bgs=C(n.currentSelect,n.allStar,n.bgs)),3==e&&(n.currentSelect="3",n.sps=C(n.currentSelect,n.allStar,n.sps)),4==e&&(n.currentSelect="2",n.lcs=C(n.currentSelect,n.allStar,n.lcs))}function j(e,t,r){I.clearStarBadge(t),(void 0==r||null==r||""==r||"null"==r)&&(r=0);var s=0;if("1"==e)for(var a=0;a<n.zxs.length;a++)if(t==n.zxs[a].id){s=n.zxs[a].badge,n.zxs[a].badge=0;break}if("2"==e)for(var a=0;a<n.lcs.length;a++)if(t==n.lcs[a].id){s=n.lcs[a].badge,n.lcs[a].badge=0;break}if("3"==e)for(var a=0;a<n.sps.length;a++)if(t==n.sps[a].id){s=n.sps[a].badge,n.sps[a].badge=0;break}if("4"==e)for(var a=0;a<n.bgs.length;a++)if(t==n.bgs[a].id){s=n.bgs[a].badge,n.bgs[a].badge=0;break}if("5"==e)for(var a=0;a<n.tss.length;a++)if(t==n.tss[a].id){s=n.tss[a].badge,n.tss[a].badge=0;break}y(e,s)}function P(e,r,a,o){if(s.show(),1==a){var l={};l.eStarUserId=o,b.checkIsBuy({eStarUserId:l.eStarUserId,sessionId:i.getObject("user").sessionId},function(i){if(s.hide(),200==i.return_code){i.data.ownUser=L.id,I.updateStar(i.data);var l=i.data.isBuy;if(1==l){var d=i.data.buyEndTime,f=(new Date).getTime();d-f>=0?(j(a,r,0),c.path("/tab/fws/fwdetail/"+e+"/"+a+"/"+o)):u.alert({title:"提示",template:"<b>尊敬的用户，您好，您的购买已经过期，请联系的业务员购买，谢谢！!</b>",okText:"确定"})}else u.alert({title:"提示",template:"尊敬的用户，您好，您还没有购买此信息，请联系业务员购买，谢谢！",okText:"确定"})}"20006"==i.return_code&&(s.hide(),n.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){s.hide(),u.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}else s.hide(),j(a,r,0),c.path("/tab/fws/fwdetail/"+e+"/"+a+"/"+o)}n.tss=new Array,n.zxs=new Array,n.bgs=new Array,n.sps=new Array,n.lcs=new Array,n.slideIndex=1,n.tsBadge=0,n.zxBadge=0,n.bgBadge=0,n.spBadge=0,n.lcBadge=0,n.starInfoCount=0,n.allStar=new Array,n.badge=0;var k=[];n.fws=k;var L=i.getObject("user"),N=L.businessUserId,A=L.id;n.businessUserName=L.businessUserName,N?n.businessUserFlag=!0:n.businessUserFlag=!1,n.phoneUserId=L.id,n.businessUserAvatar=L.businessUserAvatar,n.$on("$ionicView.enter",function(){var e=i.getObject("user"),t=e.businessUserId;e.id;n.businessUserName=e.businessUserName,t?n.businessUserFlag=!0:n.businessUserFlag=!1,n.phoneUserId=e.id,n.businessUserAvatar=e.businessUserAvatar,$(i.getObject("user").sessionId,1),r.setApplicationIconBadgeNumber(0)}),n.scan22=function(){cordova.plugins.barcodeScanner.scan(function(e){var r={};r.sessionId=i.getObject("user").sessionId,r.businessUserId=e.text,b.addBusinessByUserId(r,function(e){if("200"==e.return_code){n.businessUserFlag=!0,n.businessUserName=e.data.businessUserName,n.businessUserAvatar=e.data.businessUserAvatar,L.businessUserId=e.data.businessUserId,L.businessUserName=e.data.businessUserName,L.businessUserAvatar=e.data.businessUserAvatar,L.isActivation=e.data.isActivation,L.sessionId=e.data.sessionId,L.id=e.data.id,i.setObject("user",L);var r={userId:L.businessUserId.toString(),badge:0,lastMessage:"",lastTime:"",ownUser:L.id.toString()};I.insertChatUser(r),g.allNewStar({pageIndex:1,sessionId:i.getObject("user").sessionId},function(e){if(s.hide(),"200"==e.return_code){for(var r=e.data,a=0;a<k.length;a++)r.push(k[a]);n.fws=r}"20006"==e.return_code&&(s.hide(),n.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut")),u.alert({title:"提示",template:"绑定成功！",okText:"确定"})})}"20006"==e.return_code&&(s.hide(),n.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){s.hide(),u.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})},function(e){u.alert({title:"提示",template:"扫描失败："+e,okText:"确定"})})};S.getLastRequestTime();n.zxResult={};n.doRefresh=function(){$(i.getObject("user").sessionId,1)},document.addEventListener("online",T,!1),s.show(),$(i.getObject("user").sessionId,1),n.currentSelect="1";var R=!0;n.slideChanged=function(e){n.slideIndex=e,O(e)},n.activeSlide=function(t){e.slide(t),O(t)};var D=n.checkUserIsBuy=function(e,r,a,o){if(5==a){var l={};l.eStarUserId=o,s.show(),b.checkIsBuy({eStarUserId:l.eStarUserId,sessionId:i.getObject("user").sessionId},function(o){if(s.hide(),200==o.return_code){var i=o.data.isBuy;if(I.updateStar(o.data),1==i){var l=o.data.buyEndTime,d=(new Date).getTime();l-d>=0?(j(a,e,r),c.path("/tab/fwl/"+e)):u.alert({title:"提示",template:"尊敬的用户，您好，您的购买已经过期，请联系的业务员购买，谢谢！",okText:"确定"})}else u.alert({title:"提示",template:"尊敬的用户，您好，您还没有购买此信息，请联系业务员购买，谢谢！",okText:"确定"})}"20006"==o.return_code&&(s.hide(),n.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){s.hide(),u.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}else j(a,e,r),c.path("/tab/fwl/"+e)};t.$on("JpushService:openNotification",function(e,t,s){r.setApplicationIconBadgeNumber(0);var a={};a.category=s.category,a.starId=s.starId,a.starInfoId=s.starInfoId,I.selectStarById(a.starId,L.id.toString(),function(e,t){for(var r=t.rows,s=new Array,n=0;n<r.length;n++){var o=r.item(n),i={};for(var l in o)i[l]=o[l];s.push(i)}a.eStarUserId=s[0].eStarUserId,"5"==a.category?D(a.starId,0,a.category,a.eStarUserId):P(a.starInfoId,a.starId,a.category,a.eStarUserId)})}),n.isShowBadge=!1,t.$on("JpushService:receiveNotification",function(e,t,r){if(n.isShowBadge){var s={};if(s.category=r.category,s.starId=r.starId,"1"==s.category)for(var a=0;a<n.zxs.length;a++)if(n.zxs[a].id==s.starId){n.zxs[a].badge+=1;break}if("2"==s.category)for(var a=0;a<n.lcs.length;a++)if(n.lcs[a].id==s.starId){n.lcs[a].badge+=1;break}if("3"==s.category)for(var a=0;a<n.sps.length;a++)if(n.sps[a].id==s.starId){n.sps[a].badge+=1;break}if("4"==s.category)for(var a=0;a<n.bgs.length;a++)if(n.bgs[a].id==s.starId){n.bgs[a].badge+=1;break}if("5"==s.category)for(var a=0;a<n.tss.length;a++)if(n.tss[a].id==s.starId){n.tss[a].badge+=1;break}U(s.category,1)}})}]).controller("FwListCtrl",["$rootScope","BusyService","$location","UUIDFac","RemoteService","StoreUp","$filter","$scope","$stateParams","$interval","$timeout","$ionicPopup","Fws","Sps","Lcs","FwLists","$localstorage","webLocalDB","LastTime",function(e,t,r,s,a,n,o,i,l,c,u,d,f,g,m,p,h,w,b){function I(e,t){for(var r=t.rows,s=0;s<r.length;s++){var a=r.item(s),n={};for(var o in a)"category"==o&&(n.category=a[o]),"name"==o&&"undefined"!=a[o]&&(n.name=a[o]),"newName"==o&&"undefined"!=a[o]&&(n.newName=a[o]),"eStarUserId"==o&&"undefined"!=a[o]&&(n.eStarUserId=a[o]);i.star=n}}function S(e,t){for(var r=t.rows,s=(new Array,0),a=0;a<r.length;a++){var n=r.item(a),o={};for(var l in n)o[l]=n[l];for(var c=!0,u=0;u<i.fwLists.length;u++)o.id==i.fwLists[u].id&&(c=!1);c&&(i.isRefresh?(i.fwLists.splice(s,0,o),s++):i.fwLists.push(o))}(0==r.length||i.fwLists.length<10)&&(i.hasMoreData=!1),i.$broadcast("scroll.infiniteScrollComplete")}i.fwLists=new Array,i.lastTime=b.getLastRequestTime();var v=h.getObject("user");v.businessUserId;w.selectStarById(l.fwId,v.id,I),i.checkUserIsBuy=function(s,n,o,l){if(1==o){t.show();var c={};c.eStarUserId=l,a.checkIsBuy({eStarUserId:c.eStarUserId,sessionId:h.getObject("user").sessionId},function(a){if(t.hide(),200==a.return_code){a.data.ownUser=v.id,w.updateStar(a.data);var n=a.data.isBuy;if(1==n){var c=a.data.buyEndTime,u=(new Date).getTime();c-u>=0?r.path("/tab/fws/fwdetail/"+s+"/"+o+"/"+l):d.alert({title:"提示",template:"<b>尊敬的用户，您好，您的购买已经过期，请联系的业务员购买，谢谢！!</b>",okText:"确定"})}else d.alert({title:"提示",template:"尊敬的用户，您好，您还没有购买此信息，请联系业务员购买，谢谢！",okText:"确定"})}"20006"==a.return_code&&(t.hide(),i.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){t.hide(),d.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}else r.path("/tab/fws/fwdetail/"+s+"/"+o+"/"+l)},t.show(),i.pageIndexs=1,i.getRemoteStarInfoList=function(r,s,a){t.show(),p.all({starId:r,pageIndex:1,sessionId:s,now:a},function(r){if(t.hide(),"200"==r.return_code){var s=r.data;i.starInfolist=r.data;for(var a=(new Array,0);a<s.length;a++){i.starInfolist[a].ownUser=v.id.toString();new Date;i.starInfolist[a].dateTime=o("date")(i.starInfolist[a].datetime,"yyyy-MM-dd HH:mm:ss"),w.insertStarInfo(i.starInfolist[a]),w.updateStarInfo(i.starInfolist[a])}i.isRefresh=!0,w.selectStarInfoList(l.fwId,v.id.toString(),10,1,S),i.$broadcast("scroll.refreshComplete")}"20006"==r.return_code&&(t.hide(),i.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){i.$broadcast("scroll.refreshComplete"),t.hide(),d.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})},i.hasMoreData=!0,i.doRefresh=function(){i.getRemoteStarInfoList(l.fwId,h.getObject("user").sessionId,new Date)},i.$on("$ionicView.enter",function(){i.pageIndexs=1,i.getRemoteStarInfoList(l.fwId,h.getObject("user").sessionId,new Date)}),i.addStoreStarInfo=function(r){t.show("增加收藏中...");var n={};n.id=s.getUUID().id,n.starInfoId=r.id,n.userName=r.title,n.headImg=r.headImg,n.name=r.title,n.content=r.message,n.userId=h.getObject("user").id.toString(),n.sessionId=h.getObject("user").sessionId.toString(),n.datetime=o("date")(new Date,"yyyy年MM月dd日"),a.addStoreUp(n,function(r){"20006"==r.return_code&&(t.hide(),e.$broadcast("Login:loginTimeOut"))},function(e){t.hide(),d.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}),w.insertStoreUp(n),u(function(){t.hide()},500),d.alert({title:"提示",template:"<b>收藏成功!</b>",okText:"关闭"})},i.loadMore=function(){i.isRefresh=!1,i.pageIndexs+=1,u(function(){w.selectStarInfoList(l.fwId,v.id.toString(),10,i.pageIndexs,S)},1e3)}}]).controller("FwDetailCtrl",["$filter","$rootScope","BusyService","$ionicPopup","RemoteService","$localstorage","$location","webLocalDB","$scope","$stateParams","Fws","FwLists",function(e,t,r,s,a,n,o,i,l,c,u,d){function f(e){var t=ionic.Platform.platform();switch(t){case"android":var r=e.split("."),a=r[r.length-1],n=cordova.file.externalApplicationStorageDirectory+"local."+a,o=new FileTransfer,i=encodeURI(e);o.download(i,n,function(e){window.plugins.fileOpener.open(e.toURL())},function(e){s.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})},!1);break;default:window.open(e,"_blank","location=no,toolbar=yes,closebuttoncaption=Close PDF,enableViewportScale=yes")}}var g=n.getObject("user");l.fwList={},l.category=c.fwCategory,l.eStarUserId=c.fweStarUserId,r.show(),a.getStarInfoById({starInfoId:c.fwListId,sessionId:n.getObject("user").sessionId.toString()},function(s){"200"==s.return_code&&(r.hide(),l.starInfo=s.data,l.starInfo.ownUser=g.id.toString(),l.starInfo.dateTime=e("date")(l.starInfo.datetime,"yyyy-MM-dd HH:mm:ss"),i.insertStarInfo(l.starInfo),i.updateStarInfo(l.starInfo),l.fwList=l.starInfo),"20006"==s.return_code&&(r.hide(),t.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),s.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}),l.checkUserIsBuy=function(e,o,c,u){if(4==c){r.show();var d={};d.eStarUserId=u,d.sessionId=n.getObject("user").sessionId,a.checkIsBuy(d,function(e){if(r.hide(),200==e.return_code){e.data.ownUser=g.id,i.updateStar(e.data);var a=e.data.isBuy;if(1==a){var n=e.data.buyEndTime,o=(new Date).getTime();n-o>=0?f(l.fwList.addFile):s.alert({title:"提示",template:"尊敬的用户，您好，您的购买已经过期，请联系的业务员购买，谢谢！",okText:"确定"})}else s.alert({title:"提示",template:"尊敬的用户，您好，您还没有购买此信息，请联系业务员购买，谢谢！",okText:"确定"})}"20006"==e.return_code&&(r.hide(),l.$broadcast("scroll.refreshComplete"),t.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),s.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}}}]).controller("ChatTabCtrl",["$scope","$q",function(e,t){e.data={badgeCount:0},e.$on("chatTabUnReadCount",function(t,r){e.data.badgeCount=r})}]).controller("ChatsCtrl",["$timeout","BusyService","$rootScope","$scope","$localstorage","webLocalDB",function(e,t,r,s,a,n){function o(){n.selectChatUser(s.myId,i)}function i(e,r){t.hide();for(var a=r.rows,n=0;n<a.length;n++){var o=a.item(n),i={};for(var l in o){if("userId"==l&&(i.userId=o[l]),"badge"==l&&(i.badge=o[l]),"lastMessage"==l){var c=o[l];c.length>9&&(c=c.slice(0,9)+"..."),i.lastMessage=c}"lastTime"==l&&(i.lastTime=o[l]),"ownUser"==l&&(i.ownUser=o[l])}var u=[{id:i.userId,name:s.businessUserName,lastMessage:i.lastMessage,headImg:s.businessUserAvatar,badge:i.badge,lastTime:i.lastTime}];0==s.chats.length?s.chats=u:s.chats[0].id!=u[0].id&&(s.chats=u),s.chatTabUnReadCount+=i.badge,s.$emit("chatTabUnReadCount",s.chatTabUnReadCount)}}var l=a.getObject("user");s.myId=l.id,s.businessUserId=l.businessUserId,s.businessUserName=l.businessUserName,s.businessUserAvatar=l.businessUserAvatar,s.chats=[],s.$on("$ionicView.enter",function(){l=a.getObject("user");var r={userId:a.getObject("user").businessUserId.toString(),badge:0,lastMessage:"",lastTime:"",ownUser:""+l.id.toString()};t.show(),n.insertChatUser(r),e(o(),250)}),s.clearChatUserBadge=function(){n.clearChatUserBadge(s.businessUserId);for(var e=0;e<s.chats.length;e++){var t=s.chats[e];t.userId==s.businessUserId&&(s.chatTabUnReadCount-=s.chats[e].badge,s.$emit("chatTabUnReadCount",s.chatTabUnReadCount),s.chats[e].badge=0)}}}]).controller("ChatsDetailCtrl",["wsService","BusyService","$ionicPopup","$rootScope","$filter","RemoteService","$scope","$timeout","$interval","$localstorage","$ionicScrollDelegate","webLocalDB","Chats","UUIDFac",function(e,t,r,s,a,n,o,i,l,c,u,d,f,g){function m(e){var t={};if(t.id=e.id.toString(),t.userId=e.businessUserId.toString(),t.info=e.info,t.message=e.info,t.time=a("date")(e.createTime,"yyyy-MM-dd HH:mm:ss"),t.ownUser=o.myId.toString(),t.isSendSuccess=1,d.insertChat(t),1==e.type){for(var r=!0,s=0;s<o.messages.length;s++)o.messages[s].time==t.time&&(r=!1);r&&(o.messages.push({userId:t.userId,text:t.message,time:t.time}),u.resize(),u.scrollBottom(!0))}o.index=o.index+1}function p(e){var t="select id,userId,message,time,ownUser,isSendSuccess from chat where ownUser = "+o.myId+" order by rowid desc limit 20 offset 0;";e.executeSql(t,[],h,w)}function h(e,r){for(var s=r.rows,a=0;a<s.length;a++){var n=s.item(a),i={};for(var l in n)"userId"==l&&(i.userId=n[l]),"message"==l&&(i.message=n[l]),"time"==l&&(i.time=n[l]);o.messages.unshift({userId:i.userId,text:i.message,time:i.time})}u.resize(),u.scrollBottom(!0),t.hide(),o.index=s.length}function w(e,t){}var b=d.getDb();o.messages=[],o.$on("$ionicView.enter",function(){o.index=0;var e=c.getObject("user");o.myId=e.id,o.businessUserId=e.businessUserId,o.data={},o.chat={},o.messages=[],o.newTalk=1,t.show(),b.transaction(p)}),o.sendMessage=function(){if(""!=o.chat.message&&void 0!=o.chat.message){var t=new Date,t=a("date")(t,"yyyy-MM-dd HH:mm:ss");o.messages.push({userId:o.myId,text:o.chat.message,time:t});var r={},s=o.chat.message;r.id=g.getUUID().id,r.userId=c.getObject("user").id.toString(),r.sessionId=c.getObject("user").sessionId.toString(),r.info=s,r.time=t,r.ownUser=o.myId.toString(),r.businessUserId=o.businessUserId.toString(),r.isSendSuccess=1,d.insertChat(r),e.send(r),o.index=o.index+1,delete o.chat.message,u.scrollBottom(!0)}},s.$on("wsService:onmessage",function(e,t){var a=t.data;try{var n=angular.fromJson(a);angular.isArray(n)?angular.forEach(n,function(e,t){i(m(e))}):angular.isObject(n)&&("20006"==n.return_code?(o.$broadcast("scroll.refreshComplete"),s.$broadcast("Login:loginTimeOut",function(){r.alert({title:"提示",template:"发送超时，请重新发送！",okText:"确定"})})):"200"==n.return_code||("20004"==n.return_code?r.alert({title:"提示",template:"发送失败，请重试！",okText:"确定"}):i(m(n))))}catch(l){}}),o.inputUp=function(){o.data.keyboardHeight=216,i(function(){u.scrollBottom(!0)},300)},o.inputDown=function(){o.data.keyboardHeight=0,u.resize()},o.doRefresh=function(){i(function(){function e(e){var r=(o.index+20,"select id,userId,message,time,ownUser,isSendSuccess from chat where ownUser = "+o.myId+" order by time desc limit 20 offset "+o.index+";");e.executeSql(r,[],t,w)}function t(e,t){for(var r=t.rows,s=0;s<r.length;s++){var a=r.item(s),n={};for(var i in a)"userId"==i&&(n.userId=a[i]),"message"==i&&(n.message=a[i]),"time"==i&&(n.time=a[i]);o.messages.unshift({userId:n.userId,text:n.message,time:n.time})}o.index=o.index+r.length}o.$broadcast("scroll.refreshComplete"),b.transaction(e)},1e3)}}]).controller("JyCtrl",["$scope",function(e){e.message="尚未开通，请稍候..."}]).controller("ScCtrl",["$scope",function(e){e.message="尚未开通，请稍候..."}]).controller("KhCtrl",["$scope",function(e){e.message="尚未开通，请稍候..."}]).controller("WoCtrl",["$localstorage","$scope",function(e,t){t.$on("$ionicView.enter",function(){t.user=e.getObject("user"),t.currentUser=e.getObject(t.user.id),t.user.avatarUrl=t.currentUser.avatarUrl})}]).controller("TjywyCtrl",["$rootScope","JpushService","BusyService","webLocalDB","$state","$ionicPopup","localstorage","RemoteService","$scope","TjywyService",function(e,t,r,s,a,n,o,i,l,c){var u=o.getObject("user");l.myId=u.id,l.ywys=i.allTjywy({sessionId:o.getObject("user").sessionId},function(t){"20006"==t.return_code&&(r.hide(),l.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),n.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})}),l.data={ywy:""},l.bindYwy=function(){r.show();var t={};t.sessionId=o.getObject("user").sessionId,t.businessUserId=l.data.ywy,i.addBusinessByUserId(t,function(t){if(r.hide(),"200"==t.return_code){l.businessUserFlag=!0,l.businessUserName=t.data.businessUserName,l.businessUserAvatar=t.data.businessUserAvatar,u.businessUserId=t.data.businessUserId,u.businessUserName=t.data.businessUserName,u.businessUserAvatar=t.data.businessUserAvatar,u.isActivation=t.data.isActivation,u.sessionId=t.data.sessionId,u.id=t.data.id,o.setObject("user",u);var i={userId:u.businessUserId.toString(),badge:0,lastMessage:"",lastTime:"",ownUser:""+u.id.toString()};s.insertChatUser(i);var c=n.alert({title:"提示",template:"绑定成功！",okText:"确定"});c.then(function(e){a.go("tab.fw")})}"20006"==t.return_code&&(r.hide(),l.$broadcast("scroll.refreshComplete"),e.$broadcast("Login:loginTimeOut"))},function(e){r.hide(),n.alert({title:"提示",template:"加载失败，请重试！",okText:"确定"})})}}]).run(["$interval","$ionicLoading","$ionicPlatform","$rootScope","$ionicHistory","$state","$ionicPopup","$window","JpushService","BusyService",function(e,t,r,s,a,n,o,i,l,c){r.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),s.$on("loading:show",function(){}),s.$on("loading:hide",function(){}),l.init(),r.registerBackButtonAction(function(t){function r(){var t=o.confirm({title:"<strong>退出程序?</strong>",template:"你确定要退出吗?",cancelText:"取消",okText:"确定"});t.then(function(t){t&&(angular.isDefined(s.stopChat)&&(e.cancel(s.stopChat),s.stopChat=void 0),angular.isDefined(s.stop)&&(e.cancel(s.stop),s.stop=void 0),i.localStorage.lastExitTime=new Date,i.localStorage.lastRequestTime=new Date,i.localStorage.lastExitTime=new Date,ionic.Platform.exitApp())})}return"tab.fw"==n.current.name||"signin"==n.current.name?r():(c.hide(),navigator.app.backHistory()),!1},101)})}]).directive("input",["$timeout",function(e){return{restrict:"E",scope:{returnClose:"=",onReturn:"&",onFocus:"&",onBlur:"&"},link:function(t,r,s){r.bind("focus",function(r){t.onFocus&&e(function(){t.onFocus()})}),r.bind("blur",function(r){t.onBlur&&e(function(){t.onBlur()})}),r.bind("keydown",function(s){13==s.which&&(t.returnClose&&r[0].blur(),t.onReturn&&e(function(){t.onReturn()}))})}}}]).filter("trusted",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(e,t,r){var s={tabs:{style:"standard",position:"bottom"}};r.setPlatformConfig("android",s),t.otherwise("sign-in"),e.state("signin",{url:"/sign-in",templateUrl:"templates/sign-in.html",controller:"SignInCtrl"}).state("signup",{url:"/sign-up",templateUrl:"templates/sign-up.html",controller:"SignUpCtrl"}).state("forgotpassword",{url:"/forgot-password",templateUrl:"templates/forgot-password.html"}).state("tjywy",{url:"/tj-ywy",controller:"TjywyCtrl",templateUrl:"templates/tj-ywy.html"}).state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.fw",{url:"/fw",views:{"tab-fw":{templateUrl:"templates/tab-fw.html",controller:"FwCtrl"}}}).state("tab.fwlist",{url:"/fwl/:fwId",views:{"tab-fw":{templateUrl:"templates/fw-list.html",controller:"FwListCtrl"}}}).state("tab.fwdetail",{url:"/fws/fwdetail/:fwListId/:fwCategory/:fweStarUserId",views:{"tab-fw":{templateUrl:"templates/fw-detail.html",controller:"FwDetailCtrl"}}}).state("tab.jy",{url:"/jy",views:{"tab-jy":{templateUrl:"templates/tab-jy.html",controller:"JyCtrl"}}}).state("tab.sc",{url:"/sc",views:{"tab-sc":{templateUrl:"templates/tab-sc.html",controller:"ScCtrl"}}}).state("tab.kh",{url:"/kh",views:{"tab-kh":{templateUrl:"templates/tab-kh.html",controller:"KhCtrl"}}}).state("tab.chats",{url:"/chats",views:{"tab-chatbox":{templateUrl:"templates/tab-chats.html",controller:"ChatsCtrl"}}}).state("chat",{url:"/chats/:chatId",templateUrl:"templates/chat-detail.html",controller:"ChatsDetailCtrl"}).state("tab.wo",{url:"/wo",views:{"tab-wo":{templateUrl:"templates/tab-wo.html",controller:"WoCtrl"}}}).state("tab.wo-person",{url:"/person",views:{"tab-wo":{templateUrl:"templates/wo-person.html",controller:"PersonCtrl"}}}).state("tab.wo-person-nicename",{url:"/nicename",views:{"tab-wo":{templateUrl:"templates/wo-person-nicename.html",controller:"NicenameCtrl"}}}).state("tab.wo-person-password",{url:"/repassword",views:{"tab-wo":{templateUrl:"templates/wo-person-password.html",controller:"RepasswordCtrl"}}}).state("tab.wo-password",{url:"/password",views:{"tab-wo":{templateUrl:"templates/wo-password.html",controller:"PasswordCtrl"}}}).state("wo-storeup",{url:"/storeup",templateUrl:"templates/wo-storeup.html",controller:"StoreupCtrl"}).state("wo-storeup-content",{url:"/storeupcontent/:storeUpId",templateUrl:"templates/wo-storeup-content.html",controller:"StoreupContentCtrl"}).state("wo-storeup-add",{url:"/storeupadd",templateUrl:"templates/wo-storeup-add.html",controller:"StoreupAddCtrl"}).state("tab.wo-buser",{url:"/buser",views:{"tab-wo":{templateUrl:"templates/wo-buser.html",controller:"BuserCtrl"}}}).state("tab.wo-setting",{url:"/setting",views:{"tab-wo":{templateUrl:"templates/wo-setting.html",controller:"SettingCtrl"}}}).state("tab.wo-about",{url:"/about",views:{"tab-wo":{templateUrl:"templates/wo-setting-about.html",controller:"SettingAboutCtrl"}}}).state("tab.wo-opinion",{url:"/opinion",views:{"tab-wo":{templateUrl:"templates/wo-setting-opinion.html",controller:"SettingOpinionCtrl"}}})}]);